[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Job Applicant",
  "modified": "2021-02-23 12:31:39.363617",
  "name": "Job Applicant-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Applicant', {\n    refresh: function(frm) {\n    if(frm.doc.status != \"Selected\"){\n        frm.remove_custom_button(\"Job Offer\");\n    }\n    \n        // console.log(\"Selected\")\n        // frm.remove_custom_button(\"Schedule Interview\");\n        //   }\n    if (!frm.doc.__islocal) {\n        frappe.call({\n            'method': 'niyopolymers.hr.existing_interview_rounds',\n            'args': {\n                job_applicant: frm.doc.name,\n                job_opening: frm.doc.job_title\n                }\n         })\n    \n            .success(success => {\n                console.log(success.message);\n                if(success.message === true) {\n                      frm.add_custom_button(__(\"Show Feedback\"), function() {\n         frappe.call({\n            'method': 'niyopolymers.hr.get_interview_rounds',\n            'args': {\n                job_applicant: frm.doc.name,\n                job_opening: frm.doc.job_title\n                }\n         })\n    \n            .success(success => {\n                console.log(success.message);\n                 locals.DocType['Interviewer'] = success.message.interviewer\n                let d = new frappe.ui.Dialog({\n                title: 'Interviewers Feedback',\n                fields: success.message.interview_rounds,\n            \n                primary_action_label: 'Show Details',\n                primary_action(values) {\n                    frappe.set_route(\"List\", \"Interview Round\");\n                    console.log(values);\n                    d.hide();\n            }\n            });\n\n                 d.show();\n            });\n    });\n                }\n            })\n    if(frm.doc.status !== \"Selected\" && frm.doc.status !== \"Offered\" && frm.doc.status !== \"Offer Accepted\"){  \n     frm.add_custom_button(__(\"Schedule Interview\"), function() {\n         frappe.call({\n            'method': 'niyopolymers.hr.get_interview_and_interview_rounds',\n            'args': {\n                job_applicant: frm.doc.name,\n                job_opening: frm.doc.job_title\n                },\n    // disable the button until the request is completed\n    // btn: $('.primary-action'),\n    // freeze the screen until the request is completed\n    freeze: true,\n     error: (r) => {\n        // on error\n    },\n    callback: (r) => {\n        console.log(r.message);\n         if(r.message === false) {\n            frappe.msgprint({\n                title: __('Notification'),\n                message: __('Please Configure Interview process before Scheduling Interview'),\n               \n                primary_action:{\n                    'label': 'Create Interview Configuration',\n                    action(values) { \n                        frappe.set_route(\"Form\", \"Interview Configuration\", \"New Interview Configuration\", {\n                            designation: cur_frm.doc.designation\n                        });\n            console.log(values);\n                    }\n                }\n            });\n            }\n        else {  \n            locals.DocType['Interviewer'] = r.message.interviewer\n        let d = new frappe.ui.Dialog({\n        title: 'Interview details',\n        fields: r.message.rounds,\n    \n        primary_action_label: 'Save',\n        primary_action(values) {\n            console.log(isEmpty(values));\n            if(isEmpty(values)){\n                 d.hide();\n                 return;\n            }\n            else{\n            ScheduleInterview(values, frm.doc.name);\n            // console.log(values);\n            d.hide();\n            }\n    }\n        });\n\n    d.show();\n        }\n    },\n    });\n    });\n    }\n    }   \n        // on success\n    },\n\n});\nfunction ScheduleInterview(values, job_applicant){\n    frappe.call({\n        \"method\": \"niyopolymers.hr.save_interview_round\",\n        \"args\":{\n            \"formdata\": values,\n            \"job_applicant\": job_applicant\n        }\n    })\n    .success(success => {\n        console.log(typeof(success.message))\n        msgprint(\"Interview has been scheduled....\");\n    })\n}\nfunction isEmpty(obj) {\n    for(var key in obj) {\n        if(obj.hasOwnProperty(key))\n            return false;\n    }\n    return true;\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Salary Structure",
  "modified": "2021-02-23 14:17:43.492710",
  "name": "Salary Structure-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Salary Structure', {\n\trefresh(frm) {\n\t\t// your code here\n\t\t\tfrm.remove_custom_button('Assign to Employees')\n\t\t\tif(!frm.doc.__islocal){\n\t\t\tfrm.add_custom_button('Assign Employees', () => {\n\t\t\t    var d = new frappe.ui.Dialog({\n\t\t\t        \n\t\t\ttitle: __(\"Assign to Employees\"),\n\t\t\tfields: [\n\t\t\t\t{fieldname: \"sec_break\", fieldtype: \"Section Break\", label: __(\"Filter Employees By (Optional)\")},\n\t\t\t\t{fieldname: \"company\", fieldtype: \"Link\", options: \"Company\", label: __(\"Company\"), default: frm.doc.company, read_only:1},\n\t\t\t\t{fieldname: \"grade\", fieldtype: \"Link\", options: \"Employee Grade\", label: __(\"Employee Grade\"), change: () => {\n\t\t\t\t\t\t\n\t\t\t\t    frappe.db.get_value('Employee Grade', d.get_value('grade'), 'base_amount')\n                    .then(r => {\n                        console.log(r.message) // Open\n                        d.set_value('base', r.message.base_amount)\n                    })\n\n\t\t\t\t}},\n\t\t\t\t{fieldname:'department', fieldtype:'Link', options: 'Department', label: __('Department')},\n\t\t\t\t{fieldname:'designation', fieldtype:'Link', options: 'Designation', label: __('Designation')},\n                {fieldname:\"employee\", fieldtype: \"Link\", options: \"Employee\", label: __(\"Employee\")},\n\t\t\t\t{fieldname:'base_variable', fieldtype:'Section Break'},\n\t\t\t\t{fieldname:'from_date', fieldtype:'Date', label: __('From Date'), \"reqd\": 1},\n\t\t\t\t{fieldname:'income_tax_slab', fieldtype:'Link', label: __('Income Tax Slab'), options: 'Income Tax Slab'},\n\t\t\t\t{fieldname:'base_col_br', fieldtype:'Column Break'},\n\t\t\t\t{fieldname:'base', fieldtype:'Currency', label: __('Base'), read_only: 1}\n\t\t\t],\n\t\t\tprimary_action: function() {\n\t\t\t  console.log(d.get_value('grade'))\n\t\t\t\tvar data = d.get_values();\n\t\t\t\tdata['doc'] = frm.doc\n\t\t\t\tconsole.log(data)\n\t\t\t\tfrappe.call({\n\t\t\t\t\n\t\t\t\t\tmethod: \"niyopolymers.hr.assign_salary_structure\",\n\t\t\t\t\targs: data,\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Assign')\n\t\t});\n\n\n\t\td.show();\n\t})\n\t}\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Salary Structure Assignment",
  "modified": "2021-02-23 12:45:14.053406",
  "name": "Salary Structure Assignment-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Salary Structure Assignment', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\temployee(frm){\n\t  frappe.db.get_value('Employee', frm.doc.employee, 'grade')\n        .then(r => {\n        console.log(r.message.grade)\n        if (r.message.grade){\n            console.log('hello')\n            frappe.db.get_value('Employee Grade', r.message.grade, 'base_amount')\n            .then(r => {\n                console.log(r.message.base_amount)\n                frm.set_value('base', r.message.base_amount)\n             })\n            frappe.db.get_value('Employee Grade', r.message.grade, 'default_salary_structure')\n            .then(r => {\n                frm.set_value('salary_structure', r.message.default_salary_structure)\n             }) \n             \n\n        }\n    })\n  \n\t},\n\tbase(frm){\n        frm.set_value('salary_in_usd', frm.doc.base)\n        frappe.call({\n            \"method\": \"niyopolymers.hr.set_conversion_rate\",\n            \"args\": {\n                employee: frm.doc.employee\n            }\n        })\n        .success(success => {\n            console.log(success)\n            frm.set_value('salary_in_birr', success.message*frm.doc.base)\n        })\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Job Opening",
  "modified": "2021-02-23 17:18:53.697246",
  "name": "Job Opening-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Opening', {\n\trefresh(frm) {\n\t\t// your code here\n\t\t\n\t\tvar today = new Date();\n        var dd = String(today.getDate()).padStart(2, '0');\n        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!\n        var yyyy = today.getFullYear();\n        today = yyyy + '-' + mm + '-' + dd;\n        console.log(today)\n        console.log(frm.doc.end_date)\n        if (frm.doc.end_date < today) {\n            console.log(\"helloooooooooo\")\n            frm.set_value('status', 'Closed')\n           \n        }\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Asset Maintenance Log",
  "modified": "2021-03-20 09:40:37.385215",
  "name": "Asset Maintenance Log-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Asset Maintenance Log', {\n\trefresh(frm) {\n\tif (frm.doc.docstatus===0) {\n\t\t\tfrm.add_custom_button(__('Stock Entry'), function() {\n\t\t\t   new frappe.ui.form.MultiSelectDialog({\n                    doctype: \"Stock Entry\",\n                    target: frm,\n                    setters: {},\n                    date_field: \"posting_date\",\n                    get_query() {\n                        return {\n                            filters: { docstatus: ['!=', 2] }\n                        }\n                    },\n                    action(selections) {\n                        console.log(selections);\n                       console.log(typeof(selections))\n                       for (var i in selections){\n                           console.log(selections[i])\n                           frappe.call({\n                               method: \"niyopolymers.assets.set_items_from_stock_entry\",\n                               args: {\n                                   name: selections[i]\n                               },\n                               callback: function(r){\n                                   console.log(r.message)\n                                  let op = r.message\n                                //   me.frm.add_child(\"part_used\").item = op['item_code'];\n                                //   me.frm.refresh_field(\"part_used\");\n                                var childTable = cur_frm.add_child(\"part_used\");\n                                childTable.item=op['item_code']\n                                childTable.item_name=op['item_name']\n                                childTable.stock_entry = op['parent']\n                                childTable.item_group=op['item_group']\n                                childTable.dscription=op['description']\n                                childTable.uom=op['uom']\n                                childTable.quantity=op['qty']\n                                cur_frm.refresh_fields(\"part_used\");\n                                $('.modal').hide();\n                               }\n                           })\n                    }\n                    }\n                });\n\t\t\t}, __(\"Get items from\"));\n\t}\n    }\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Asset Repair",
  "modified": "2021-05-27 18:32:11.322134",
  "name": "Asset Repair-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Asset Repair', {\n\tasset_name(frm) {\n\t\t// your code here\n\t\tif(frm.doc.asset_name) {\n\t\t    frappe.model.get_value('Asset', {'name': frm.doc.asset_name}, 'engineer', \n\t\t        function(res){\n\t\t            frm.set_value('assign_to', res.engineer)\n\t\t            \n                })\n\t\t}\n    },\n    refresh(frm) {\n\tif (frm.doc.docstatus===0) {\n\t\t\tfrm.add_custom_button(__('Stock Entry'), function() {\n\t\t\t   new frappe.ui.form.MultiSelectDialog({\n                    doctype: \"Stock Entry\",\n                    target: frm,\n                    setters: {},\n                    date_field: \"posting_date\",\n                    get_query() {\n                        return {\n                            filters: { docstatus: ['!=', 2] }\n                        }\n                    },\n                    action(selections) {\n                        console.log(selections);\n                       console.log(typeof(selections))\n                       for (var i in selections){\n                           console.log(selections[i])\n                           frappe.call({\n                               method: \"niyopolymers.assets.set_items_from_stock_entry\",\n                               args: {\n                                   name: selections[i]\n                               },\n                               callback: function(r){\n                                   console.log(r.message)\n                                  let op = r.message\n                                //   me.frm.add_child(\"part_used\").item = op['item_code'];\n                                //   me.frm.refresh_field(\"part_used\");\n                                var childTable = cur_frm.add_child(\"parts_used\");\n                                childTable.item=op['item_code']\n                                childTable.item_name=op['item_name']\n                                childTable.stock_entry = op['parent']\n                                childTable.item_group=op['item_group']\n                                childTable.dscription=op['description']\n                                childTable.uom=op['uom']\n                                childTable.quantity=op['qty']\n                                cur_frm.refresh_fields(\"part_used\");\n                                $('.modal').hide();\n                               }\n                           })\n                    }\n                    }\n                });\n\t\t\t}, __(\"Get items from\"));\n    \t}\n    }\n})\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Sales Invoice",
  "modified": "2021-05-27 18:33:36.581672",
  "name": "Sales Invoice-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Sales Invoice', {\n        fs_number:function(frm) {\n\t\tvar a = frm.doc.fs_number;\n\t\tvar mystr = a.replace(/\\D/g,'');\n\t\tfrm.set_value('fs_number',mystr);\n\t\tfrm.refresh_field('fs_number')\n\t},\n});\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Payment Entry",
  "modified": "2021-03-19 12:19:08.063971",
  "name": "Payment Entry-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Payment Entry', {\n    \n    setup:function(frm){\n        if(frm.doc.pra){\n           \n            // frm.set_value('payment_type', 'Pay');\n            // frm.set_value('paid_to', '11200-02 - Staff Debtors - ETL');\n            frappe.db.get_doc('Payment Request and Authorization', frm.doc.pra)\n                .then(doc => {\n                    console.log(doc)\n                    \n                    \n                   \n                    frappe.run_serially([\n                        ()=>{  frm.set_value('payment_type', 'Pay')},\n                        ()=>{ frm.set_value('mode_of_payment', doc.payment_mode) },\n                        ()=> {\n                             frm.set_value('party_type', doc.party_type)\n                                .then(()=> { \n                                    setTimeout(()=>{ frm.set_value('party', doc.party)}, 1000)\n                                   \n                            })\n                        },\n                       \n                        ()=>{frm.set_value('paid_amount', doc.amount)},\n                        ()=>{frm.set_value('notes', doc.payment_reason)},\n                        ()=>{frm.set_value('documents_attached', doc.name)}\n                        \n                        //  ()=>{  setTimeout( ()=>{  frm.set_value('party', doc.party)}, 600)},\n                        //   ()=>{  frm.set_value('party', doc.party)},\n                    ])\n                    // frm.set_value('mode_of_payment', doc.payment_mode);\n                   \n                    // frm.set_value('paid_amount', doc.amount);\n                })\n\n        }\n    }\n\n})    "
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Purchase Invoice",
  "modified": "2021-03-19 12:19:31.775942",
  "name": "Purchase Invoice-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Purchase Invoice', {\n        bill_no:function(frm) {\n\t\tvar a = frm.doc.bill_no;\n\t\tvar mystr = a.replace(/\\D/g,'');\n\t\tfrm.set_value('bill_no',mystr);\n\t\tfrm.refresh_field('bill_no')\n\t}\n});\n\nfrappe.ui.form.on('Purchase Invoice', {\n        withholding_receipt_no:function(frm) {\n\t\tvar a = frm.doc.withholding_receipt_no;\n\t\tvar mystr = a.replace(/\\D/g,'');\n\t\tfrm.set_value('withholding_receipt_no',mystr);\n\t\tfrm.refresh_field('withholding_receipt_no')\n\t},\n\trefresh: function(frm){\n\t    frm.fields_dict['items'].grid.get_field(\"expense_account\").get_query = function(doc, cdt, cdn) {\n\t        return{\n\t            filters: [\n\t                ['Account', 'is_group', '=', 'No'],\n\t                ['Account', 'company', '=', frm.doc.company]\n\t             ]\n\t        }\n\t    }\n\t},\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Quotation",
  "modified": "2021-03-19 12:20:06.008532",
  "name": "Quotation-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Quotation', {\n\trefresh:function(frm) {\n\t\tfrm.set_df_property('customer_address', 'reqd', 1)\n\t\tif (frm.doc.__islocal && frm.doc.valid_till && frm.doc.party_name) {\n\t\t    console.log('ja na e')\n\t\t    frm.set_value('valid_till', null)\n\t\t    frm.refresh()\n\t\t  //  frm.set_value('valid_till', frappe.datetime.add_months(doc.transaction_date, 1))\n\t\t}\n\t},\n\tcopy_doc: function(frm){\n\t    console.log(\"helo\", frm.doc)\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Delivery Note",
  "modified": "2021-03-19 12:20:52.795526",
  "name": "Delivery Note-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Delivery Note', {\n\tpo_no:function(frm) {\n\t\tvar a = frm.doc.po_no;\n\t\t\n\t\tconsole.log(\"type of a -->\",typeof a);\n\t\t\n\t\tvar mystr = a.replace(/\\D/g,'');\n\t\tconsole.log(\"removed alphabets-->\",mystr);\n\t\tfrm.set_value('po_no',mystr);\n\t\tfrm.refresh_field('po_no')\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Item",
  "modified": "2021-03-19 12:21:18.610852",
  "name": "Item-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "function updateUOM(frm){\n    var itemDocument = frm.doc\n    console.log(\"in function update\")\n    \n    \n    if (frm.doc.uoms.length < \"2\"){\n        console.log(\"In If of update\")\n        \n        let d = frm.add_child(\"uoms\");\n        d.uom = \"Nos\";\n\t    d.conversion_factor = itemDocument.standard_weight;\n\t\t refresh_field(\"uoms\");\n\t    console.log(\"print value of d\",d);\n\t    \n\t    console.log(\"Leaving If of update\")\n        \n    }\n    else{\n        console.log(\"In Else of update\")\n        console.log(frm.doc.uoms[1])\n        frm.doc.uoms[1].conversion_factor = itemDocument.standard_weight;\n        \n        refresh_field(\"uoms\");\n        \n        \n        console.log(\"LEaving Else of update\")\n        \n    }\n    \n    \n    \n}\n\n\nfunction weight(frm){\n    var a = frm.doc;\n    if(a.diameter!==0 && a.thickness!==0){\n        var w = 3.14 * (a.diameter/2) * (a.diameter/2) * a.thickness * (2700/1000000000);\n\t\tfrm.set_value('standard_weight',w);\n    }\n    if(a.diameter===0 || a.thickness===0){\n        frm.set_value('standard_weight','0');\n        \n    }\n}\n\n\n\n\nfrappe.ui.form.on('Item', {\n\tdiameter:function(frm) {\n\t    weight(frm)\n    }\n    \n});\n\nfrappe.ui.form.on('Item', {\n\tthickness:function(frm){\n\t     console.log(\"============\")\n\t     console.log(doc.name)\n\t    weight(frm)\n\t    refresh_field(\"standard_weight\");\n\t}\n\t\n});\t\n\nfrappe.ui.form.on('Item',{\n    standard_weight:function(frm){\n        updateUOM(frm);\n        console.log(doc.name)\n    }\n    \n    \n});\n    "
 }
]