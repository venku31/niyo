[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Job Applicant",
  "modified": "2021-02-23 12:31:39.363617",
  "name": "Job Applicant-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Applicant', {\n    refresh: function(frm) {\n    if(frm.doc.status != \"Selected\"){\n        frm.remove_custom_button(\"Job Offer\");\n    }\n    \n        // console.log(\"Selected\")\n        // frm.remove_custom_button(\"Schedule Interview\");\n        //   }\n    if (!frm.doc.__islocal) {\n        frappe.call({\n            'method': 'niyopolymers.hr.existing_interview_rounds',\n            'args': {\n                job_applicant: frm.doc.name,\n                job_opening: frm.doc.job_title\n                }\n         })\n    \n            .success(success => {\n                console.log(success.message);\n                if(success.message === true) {\n                      frm.add_custom_button(__(\"Show Feedback\"), function() {\n         frappe.call({\n            'method': 'niyopolymers.hr.get_interview_rounds',\n            'args': {\n                job_applicant: frm.doc.name,\n                job_opening: frm.doc.job_title\n                }\n         })\n    \n            .success(success => {\n                console.log(success.message);\n                 locals.DocType['Interviewer'] = success.message.interviewer\n                let d = new frappe.ui.Dialog({\n                title: 'Interviewers Feedback',\n                fields: success.message.interview_rounds,\n            \n                primary_action_label: 'Show Details',\n                primary_action(values) {\n                    frappe.set_route(\"List\", \"Interview Round\");\n                    console.log(values);\n                    d.hide();\n            }\n            });\n\n                 d.show();\n            });\n    });\n                }\n            })\n    if(frm.doc.status !== \"Selected\" && frm.doc.status !== \"Offered\" && frm.doc.status !== \"Offer Accepted\"){  \n     frm.add_custom_button(__(\"Schedule Interview\"), function() {\n         frappe.call({\n            'method': 'niyopolymers.hr.get_interview_and_interview_rounds',\n            'args': {\n                job_applicant: frm.doc.name,\n                job_opening: frm.doc.job_title\n                },\n    // disable the button until the request is completed\n    // btn: $('.primary-action'),\n    // freeze the screen until the request is completed\n    freeze: true,\n     error: (r) => {\n        // on error\n    },\n    callback: (r) => {\n        console.log(r.message);\n         if(r.message === false) {\n            frappe.msgprint({\n                title: __('Notification'),\n                message: __('Please Configure Interview process before Scheduling Interview'),\n               \n                primary_action:{\n                    'label': 'Create Interview Configuration',\n                    action(values) { \n                        frappe.set_route(\"Form\", \"Interview Configuration\", \"New Interview Configuration\", {\n                            designation: cur_frm.doc.designation\n                        });\n            console.log(values);\n                    }\n                }\n            });\n            }\n        else {  \n            locals.DocType['Interviewer'] = r.message.interviewer\n        let d = new frappe.ui.Dialog({\n        title: 'Interview details',\n        fields: r.message.rounds,\n    \n        primary_action_label: 'Save',\n        primary_action(values) {\n            console.log(isEmpty(values));\n            if(isEmpty(values)){\n                 d.hide();\n                 return;\n            }\n            else{\n            ScheduleInterview(values, frm.doc.name);\n            // console.log(values);\n            d.hide();\n            }\n    }\n        });\n\n    d.show();\n        }\n    },\n    });\n    });\n    }\n    }   \n        // on success\n    },\n\n});\nfunction ScheduleInterview(values, job_applicant){\n    frappe.call({\n        \"method\": \"niyopolymers.hr.save_interview_round\",\n        \"args\":{\n            \"formdata\": values,\n            \"job_applicant\": job_applicant\n        }\n    })\n    .success(success => {\n        console.log(typeof(success.message))\n        msgprint(\"Interview has been scheduled....\");\n    })\n}\nfunction isEmpty(obj) {\n    for(var key in obj) {\n        if(obj.hasOwnProperty(key))\n            return false;\n    }\n    return true;\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Salary Structure",
  "modified": "2021-02-23 14:17:43.492710",
  "name": "Salary Structure-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Salary Structure', {\n\trefresh(frm) {\n\t\t// your code here\n\t\t\tfrm.remove_custom_button('Assign to Employees')\n\t\t\tif(!frm.doc.__islocal){\n\t\t\tfrm.add_custom_button('Assign Employees', () => {\n\t\t\t    var d = new frappe.ui.Dialog({\n\t\t\t        \n\t\t\ttitle: __(\"Assign to Employees\"),\n\t\t\tfields: [\n\t\t\t\t{fieldname: \"sec_break\", fieldtype: \"Section Break\", label: __(\"Filter Employees By (Optional)\")},\n\t\t\t\t{fieldname: \"company\", fieldtype: \"Link\", options: \"Company\", label: __(\"Company\"), default: frm.doc.company, read_only:1},\n\t\t\t\t{fieldname: \"grade\", fieldtype: \"Link\", options: \"Employee Grade\", label: __(\"Employee Grade\"), change: () => {\n\t\t\t\t\t\t\n\t\t\t\t    frappe.db.get_value('Employee Grade', d.get_value('grade'), 'base_amount')\n                    .then(r => {\n                        console.log(r.message) // Open\n                        d.set_value('base', r.message.base_amount)\n                    })\n\n\t\t\t\t}},\n\t\t\t\t{fieldname:'department', fieldtype:'Link', options: 'Department', label: __('Department')},\n\t\t\t\t{fieldname:'designation', fieldtype:'Link', options: 'Designation', label: __('Designation')},\n                {fieldname:\"employee\", fieldtype: \"Link\", options: \"Employee\", label: __(\"Employee\")},\n\t\t\t\t{fieldname:'base_variable', fieldtype:'Section Break'},\n\t\t\t\t{fieldname:'from_date', fieldtype:'Date', label: __('From Date'), \"reqd\": 1},\n\t\t\t\t{fieldname:'income_tax_slab', fieldtype:'Link', label: __('Income Tax Slab'), options: 'Income Tax Slab'},\n\t\t\t\t{fieldname:'base_col_br', fieldtype:'Column Break'},\n\t\t\t\t{fieldname:'base', fieldtype:'Currency', label: __('Base'), read_only: 1}\n\t\t\t],\n\t\t\tprimary_action: function() {\n\t\t\t  console.log(d.get_value('grade'))\n\t\t\t\tvar data = d.get_values();\n\t\t\t\tdata['doc'] = frm.doc\n\t\t\t\tconsole.log(data)\n\t\t\t\tfrappe.call({\n\t\t\t\t\n\t\t\t\t\tmethod: \"niyopolymers.hr.assign_salary_structure\",\n\t\t\t\t\targs: data,\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Assign')\n\t\t});\n\n\n\t\td.show();\n\t})\n\t}\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Salary Structure Assignment",
  "modified": "2021-02-23 12:45:14.053406",
  "name": "Salary Structure Assignment-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Salary Structure Assignment', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\temployee(frm){\n\t  frappe.db.get_value('Employee', frm.doc.employee, 'grade')\n        .then(r => {\n        console.log(r.message.grade)\n        if (r.message.grade){\n            console.log('hello')\n            frappe.db.get_value('Employee Grade', r.message.grade, 'base_amount')\n            .then(r => {\n                console.log(r.message.base_amount)\n                frm.set_value('base', r.message.base_amount)\n             })\n            frappe.db.get_value('Employee Grade', r.message.grade, 'default_salary_structure')\n            .then(r => {\n                frm.set_value('salary_structure', r.message.default_salary_structure)\n             }) \n             \n\n        }\n    })\n  \n\t},\n\tbase(frm){\n        frm.set_value('salary_in_usd', frm.doc.base)\n        frappe.call({\n            \"method\": \"niyopolymers.hr.set_conversion_rate\",\n            \"args\": {\n                employee: frm.doc.employee\n            }\n        })\n        .success(success => {\n            console.log(success)\n            frm.set_value('salary_in_birr', success.message*frm.doc.base)\n        })\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Salary Slip",
  "modified": "2021-03-09 15:26:55.189022",
  "name": "Salary Slip-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Salary Slip', {\n\tonload(frm) {\n\t    if(!frm.doc.__islocal){\n    \t        frappe.call({\n    \t\t    'method': 'niyopolymers.hr.set_working_days',\n    \t\t    'args': {\n    \t\t        doc : frm.doc\n    \t\t    }\n    \t\t})\n    \t\t.success(success => {\n    \t\t    console.log(success.message)\n    \t\t  //  frm.refresh()\n    \t\t  //frm.set_value('total_working_days', success.message)\n    \t\t  //frm.save()\n    \t})\n    \t\n\t}\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Job Opening",
  "modified": "2021-02-23 17:18:53.697246",
  "name": "Job Opening-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Opening', {\n\trefresh(frm) {\n\t\t// your code here\n\t\t\n\t\tvar today = new Date();\n        var dd = String(today.getDate()).padStart(2, '0');\n        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!\n        var yyyy = today.getFullYear();\n        today = yyyy + '-' + mm + '-' + dd;\n        console.log(today)\n        console.log(frm.doc.end_date)\n        if (frm.doc.end_date < today) {\n            console.log(\"helloooooooooo\")\n            frm.set_value('status', 'Closed')\n           \n        }\n\t}\n})"
 }
]